<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Register Patient</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-lg animate__animated animate__fadeIn">
  <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">Bedridden Patient Registration</h2>

  <form id="regForm" class="space-y-3" onsubmit="event.preventDefault(); registerPatient();">

    <input class="input-field" type="text" id="national_id" placeholder="National ID *" required>
    <input class="input-field" type="text" id="full_name" placeholder="Full Name *" required>
    <input class="input-field" type="date" id="dob" placeholder="Date of Birth">
    <select class="input-field" id="sex">
      <option value="">Select Sex</option>
      <option>Male</option>
      <option>Female</option>
    </select>
    <textarea class="input-field" id="address" placeholder="Address"></textarea>
    <input class="input-field" type="text" id="island" placeholder="Island">
    <input class="input-field" type="tel" id="contact" placeholder="Contact Number">
    <input class="input-field" type="text" id="caregiver_name" placeholder="Caregiver Name">
    <input class="input-field" type="tel" id="caregiver_contact" placeholder="Caregiver Contact">
    <textarea class="input-field" id="remarks" placeholder="Remarks"></textarea>

    <button class="bg-blue-600 text-white py-2 px-4 rounded w-full hover:bg-blue-700 transition" type="submit">
      Register Patient
    </button>

    <p id="status" class="text-center mt-2 text-sm"></p>
  </form>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbxmcWZi7YlMySKKbBhKkhUh3Ynj1LuVMV0o7YlgcTCrp8AA4pDypJs4XZWWi2dLn7Mq/exec";

async function registerPatient() {
  const payload = {
    action: "registerPatient",
    national_id: national_id.value.trim(),
    full_name: full_name.value.trim(),
    dob: dob.value,
    sex: sex.value,
    address: address.value,
    island: island.value,
    contact: contact.value,
    caregiver_name: caregiver_name.value,
    caregiver_contact: caregiver_contact.value,
    remarks: remarks.value
  };

  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify(payload)
    });
    const data = await res.json();

    if (data.error) {
      status.innerText = `❌ ${data.error}`;
      status.className = "text-red-500 text-center mt-2";
      return;
    }

    if (data.status === "exists") {
      status.innerText = "⚠ Patient already registered.";
      status.className = "text-yellow-500 text-center mt-2";
      return;
    }

    status.innerText = "✅ Patient registered successfully!";
    status.className = "text-green-500 text-center mt-2";
    document.getElementById("regForm").reset();
    setTimeout(()=> window.location.href="index.html",1500);

  } catch (err) {
    status.innerText = "❌ Network error. Data not sent.";
    status.className = "text-red-500 text-center mt-2";
  }
}
</script>

<style>
.input-field {
  @apply w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-400;
}
</style>

</body>
</html>
